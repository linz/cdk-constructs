"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.handler = void 0;
const aws_sdk_1 = require("aws-sdk");
const ecs = new aws_sdk_1.ECS();
const getProperties = (props) => ({
    cluster: props.Cluster,
    serviceName: props.ServiceName,
    containerName: props.ContainerName,
    taskDefinition: props.TaskDefinition,
    launchType: props.LaunchType,
    platformVersion: props.PlatformVersion,
    desiredCount: props.DesiredCount,
    subnets: props.Subnets,
    securityGroups: props.SecurityGroups,
    targetGroupArn: props.TargetGroupArn,
    containerPort: props.ContainerPort,
    schedulingStrategy: props.SchedulingStrategy,
    healthCheckGracePeriodSeconds: props.HealthCheckGracePeriod,
    deploymentConfiguration: props.DeploymentConfiguration,
});
const onCreate = async (event) => {
    const { cluster, serviceName, containerName, taskDefinition, launchType, platformVersion, desiredCount, subnets, securityGroups, targetGroupArn, containerPort, schedulingStrategy, healthCheckGracePeriodSeconds, deploymentConfiguration, } = getProperties(event.ResourceProperties);
    const { service } = await ecs
        .createService({
        cluster,
        serviceName,
        taskDefinition,
        launchType,
        platformVersion,
        desiredCount,
        schedulingStrategy,
        deploymentController: {
            type: 'CODE_DEPLOY',
        },
        networkConfiguration: {
            awsvpcConfiguration: {
                subnets,
                securityGroups,
            },
        },
        deploymentConfiguration,
        healthCheckGracePeriodSeconds,
        loadBalancers: [
            {
                targetGroupArn: targetGroupArn,
                containerPort,
                containerName,
            },
        ],
    })
        .promise();
    if (!service)
        throw Error('Service could not be created');
    return {
        PhysicalResourceId: service.serviceArn,
        Data: {
            ServiceName: service.serviceName,
        },
    };
};
/**
 * For services using the blue/green (CODE_DEPLOY) deployment controller,
 * only the desired count, deployment configuration, task placement constraints
 * and strategies, and health check grace period can be updated using this API.
 * If the network configuration, platform version, or task definition need to be
 * updated, a new AWS CodeDeploy deployment should be created.
 * For more information, see CreateDeployment in the AWS CodeDeploy API Reference.
 */
const onUpdate = async (event) => {
    const { cluster, serviceName, desiredCount, deploymentConfiguration, healthCheckGracePeriodSeconds } = getProperties(event.ResourceProperties);
    const { service } = await ecs
        .updateService({
        service: serviceName,
        cluster,
        desiredCount,
        deploymentConfiguration,
        healthCheckGracePeriodSeconds,
    })
        .promise();
    if (!service)
        throw Error('Service could not be updated');
    return {
        PhysicalResourceId: service.serviceArn,
        Data: {
            ServiceName: service.serviceName,
        },
    };
};
const onDelete = async (event) => {
    const { cluster, serviceName } = getProperties(event.ResourceProperties);
    await ecs
        .deleteService({
        service: serviceName,
        cluster,
        force: true,
    })
        .promise();
    await ecs
        .waitFor('servicesInactive', {
        cluster,
        services: [serviceName],
    })
        .promise();
};
exports.handler = async (event) => {
    const requestType = event.RequestType;
    switch (requestType) {
        case 'Create':
            return onCreate(event);
        case 'Update':
            return onUpdate(event);
        case 'Delete':
            return onDelete(event);
        default:
            throw new Error(`Invalid request type: ${requestType}`);
    }
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi9zcmMvbGFtYmRhcy9lY3Mtc2VydmljZS9pbmRleC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7QUFNQSxxQ0FBOEI7QUEwQjlCLE1BQU0sR0FBRyxHQUFHLElBQUksYUFBRyxFQUFFLENBQUM7QUFFdEIsTUFBTSxhQUFhLEdBQUcsQ0FBQyxLQUE4RCxFQUF5QixFQUFFLENBQUMsQ0FBQztJQUNoSCxPQUFPLEVBQUUsS0FBSyxDQUFDLE9BQU87SUFDdEIsV0FBVyxFQUFFLEtBQUssQ0FBQyxXQUFXO0lBQzlCLGFBQWEsRUFBRSxLQUFLLENBQUMsYUFBYTtJQUNsQyxjQUFjLEVBQUUsS0FBSyxDQUFDLGNBQWM7SUFDcEMsVUFBVSxFQUFFLEtBQUssQ0FBQyxVQUFVO0lBQzVCLGVBQWUsRUFBRSxLQUFLLENBQUMsZUFBZTtJQUN0QyxZQUFZLEVBQUUsS0FBSyxDQUFDLFlBQVk7SUFDaEMsT0FBTyxFQUFFLEtBQUssQ0FBQyxPQUFPO0lBQ3RCLGNBQWMsRUFBRSxLQUFLLENBQUMsY0FBYztJQUNwQyxjQUFjLEVBQUUsS0FBSyxDQUFDLGNBQWM7SUFDcEMsYUFBYSxFQUFFLEtBQUssQ0FBQyxhQUFhO0lBQ2xDLGtCQUFrQixFQUFFLEtBQUssQ0FBQyxrQkFBa0I7SUFDNUMsNkJBQTZCLEVBQUUsS0FBSyxDQUFDLHNCQUFzQjtJQUMzRCx1QkFBdUIsRUFBRSxLQUFLLENBQUMsdUJBQXVCO0NBQ3ZELENBQUMsQ0FBQztBQUVILE1BQU0sUUFBUSxHQUFHLEtBQUssRUFBRSxLQUE4QyxFQUEwQixFQUFFO0lBQ2hHLE1BQU0sRUFDSixPQUFPLEVBQ1AsV0FBVyxFQUNYLGFBQWEsRUFDYixjQUFjLEVBQ2QsVUFBVSxFQUNWLGVBQWUsRUFDZixZQUFZLEVBQ1osT0FBTyxFQUNQLGNBQWMsRUFDZCxjQUFjLEVBQ2QsYUFBYSxFQUNiLGtCQUFrQixFQUNsQiw2QkFBNkIsRUFDN0IsdUJBQXVCLEdBQ3hCLEdBQUcsYUFBYSxDQUFDLEtBQUssQ0FBQyxrQkFBa0IsQ0FBQyxDQUFDO0lBRTVDLE1BQU0sRUFBRSxPQUFPLEVBQUUsR0FBRyxNQUFNLEdBQUc7U0FDMUIsYUFBYSxDQUFDO1FBQ2IsT0FBTztRQUNQLFdBQVc7UUFDWCxjQUFjO1FBQ2QsVUFBVTtRQUNWLGVBQWU7UUFDZixZQUFZO1FBQ1osa0JBQWtCO1FBQ2xCLG9CQUFvQixFQUFFO1lBQ3BCLElBQUksRUFBRSxhQUFhO1NBQ3BCO1FBQ0Qsb0JBQW9CLEVBQUU7WUFDcEIsbUJBQW1CLEVBQUU7Z0JBQ25CLE9BQU87Z0JBQ1AsY0FBYzthQUNmO1NBQ0Y7UUFDRCx1QkFBdUI7UUFDdkIsNkJBQTZCO1FBQzdCLGFBQWEsRUFBRTtZQUNiO2dCQUNFLGNBQWMsRUFBRSxjQUFjO2dCQUM5QixhQUFhO2dCQUNiLGFBQWE7YUFDZDtTQUNGO0tBQ0YsQ0FBQztTQUNELE9BQU8sRUFBRSxDQUFDO0lBRWIsSUFBSSxDQUFDLE9BQU87UUFBRSxNQUFNLEtBQUssQ0FBQyw4QkFBOEIsQ0FBQyxDQUFDO0lBRTFELE9BQU87UUFDTCxrQkFBa0IsRUFBRSxPQUFPLENBQUMsVUFBb0I7UUFDaEQsSUFBSSxFQUFFO1lBQ0osV0FBVyxFQUFFLE9BQU8sQ0FBQyxXQUFxQjtTQUMzQztLQUNGLENBQUM7QUFDSixDQUFDLENBQUM7QUFFRjs7Ozs7OztHQU9HO0FBQ0gsTUFBTSxRQUFRLEdBQUcsS0FBSyxFQUFFLEtBQThDLEVBQTBCLEVBQUU7SUFDaEcsTUFBTSxFQUFFLE9BQU8sRUFBRSxXQUFXLEVBQUUsWUFBWSxFQUFFLHVCQUF1QixFQUFFLDZCQUE2QixFQUFFLEdBQUcsYUFBYSxDQUFDLEtBQUssQ0FBQyxrQkFBa0IsQ0FBQyxDQUFDO0lBRS9JLE1BQU0sRUFBRSxPQUFPLEVBQUUsR0FBRyxNQUFNLEdBQUc7U0FDMUIsYUFBYSxDQUFDO1FBQ2IsT0FBTyxFQUFFLFdBQVc7UUFDcEIsT0FBTztRQUNQLFlBQVk7UUFDWix1QkFBdUI7UUFDdkIsNkJBQTZCO0tBQzlCLENBQUM7U0FDRCxPQUFPLEVBQUUsQ0FBQztJQUViLElBQUksQ0FBQyxPQUFPO1FBQUUsTUFBTSxLQUFLLENBQUMsOEJBQThCLENBQUMsQ0FBQztJQUUxRCxPQUFPO1FBQ0wsa0JBQWtCLEVBQUUsT0FBTyxDQUFDLFVBQW9CO1FBQ2hELElBQUksRUFBRTtZQUNKLFdBQVcsRUFBRSxPQUFPLENBQUMsV0FBcUI7U0FDM0M7S0FDRixDQUFDO0FBQ0osQ0FBQyxDQUFDO0FBRUYsTUFBTSxRQUFRLEdBQUcsS0FBSyxFQUFFLEtBQThDLEVBQWlCLEVBQUU7SUFDdkYsTUFBTSxFQUFFLE9BQU8sRUFBRSxXQUFXLEVBQUUsR0FBRyxhQUFhLENBQUMsS0FBSyxDQUFDLGtCQUFrQixDQUFDLENBQUM7SUFFekUsTUFBTSxHQUFHO1NBQ04sYUFBYSxDQUFDO1FBQ2IsT0FBTyxFQUFFLFdBQVc7UUFDcEIsT0FBTztRQUNQLEtBQUssRUFBRSxJQUFJO0tBQ1osQ0FBQztTQUNELE9BQU8sRUFBRSxDQUFDO0lBRWIsTUFBTSxHQUFHO1NBQ04sT0FBTyxDQUFDLGtCQUFrQixFQUFFO1FBQzNCLE9BQU87UUFDUCxRQUFRLEVBQUUsQ0FBQyxXQUFXLENBQUM7S0FDeEIsQ0FBQztTQUNELE9BQU8sRUFBRSxDQUFDO0FBQ2YsQ0FBQyxDQUFDO0FBRVcsUUFBQSxPQUFPLEdBQUcsS0FBSyxFQUFFLEtBQXdDLEVBQWlDLEVBQUU7SUFDdkcsTUFBTSxXQUFXLEdBQUcsS0FBSyxDQUFDLFdBQVcsQ0FBQztJQUV0QyxRQUFRLFdBQVcsRUFBRTtRQUNuQixLQUFLLFFBQVE7WUFDWCxPQUFPLFFBQVEsQ0FBQyxLQUFnRCxDQUFDLENBQUM7UUFDcEUsS0FBSyxRQUFRO1lBQ1gsT0FBTyxRQUFRLENBQUMsS0FBZ0QsQ0FBQyxDQUFDO1FBQ3BFLEtBQUssUUFBUTtZQUNYLE9BQU8sUUFBUSxDQUFDLEtBQWdELENBQUMsQ0FBQztRQUNwRTtZQUNFLE1BQU0sSUFBSSxLQUFLLENBQUMseUJBQXlCLFdBQVcsRUFBRSxDQUFDLENBQUM7S0FDM0Q7QUFDSCxDQUFDLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgdHlwZSB7XHJcbiAgQ2xvdWRGb3JtYXRpb25DdXN0b21SZXNvdXJjZUV2ZW50LFxyXG4gIENsb3VkRm9ybWF0aW9uQ3VzdG9tUmVzb3VyY2VDcmVhdGVFdmVudCxcclxuICBDbG91ZEZvcm1hdGlvbkN1c3RvbVJlc291cmNlVXBkYXRlRXZlbnQsXHJcbiAgQ2xvdWRGb3JtYXRpb25DdXN0b21SZXNvdXJjZURlbGV0ZUV2ZW50LFxyXG59IGZyb20gJ2F3cy1sYW1iZGEnO1xyXG5pbXBvcnQgeyBFQ1MgfSBmcm9tICdhd3Mtc2RrJztcclxuXHJcbmludGVyZmFjZSBIYW5kbGVyUmV0dXJuIHtcclxuICBQaHlzaWNhbFJlc291cmNlSWQ6IHN0cmluZztcclxuICBEYXRhOiB7XHJcbiAgICBTZXJ2aWNlTmFtZTogc3RyaW5nO1xyXG4gIH07XHJcbn1cclxuXHJcbmV4cG9ydCBpbnRlcmZhY2UgQmx1ZUdyZWVuU2VydmljZVByb3BzIHtcclxuICBjbHVzdGVyOiBzdHJpbmc7XHJcbiAgc2VydmljZU5hbWU6IHN0cmluZztcclxuICBjb250YWluZXJOYW1lOiBzdHJpbmc7XHJcbiAgdGFza0RlZmluaXRpb246IHN0cmluZztcclxuICBsYXVuY2hUeXBlOiBzdHJpbmc7XHJcbiAgcGxhdGZvcm1WZXJzaW9uOiBzdHJpbmc7XHJcbiAgZGVzaXJlZENvdW50OiBudW1iZXI7XHJcbiAgc3VibmV0czogc3RyaW5nW107XHJcbiAgc2VjdXJpdHlHcm91cHM6IHN0cmluZ1tdO1xyXG4gIHRhcmdldEdyb3VwQXJuOiBzdHJpbmc7XHJcbiAgY29udGFpbmVyUG9ydDogbnVtYmVyO1xyXG4gIHNjaGVkdWxpbmdTdHJhdGVneTogc3RyaW5nO1xyXG4gIGhlYWx0aENoZWNrR3JhY2VQZXJpb2RTZWNvbmRzOiBudW1iZXI7XHJcbiAgZGVwbG95bWVudENvbmZpZ3VyYXRpb246IEVDUy5EZXBsb3ltZW50Q29uZmlndXJhdGlvbjtcclxufVxyXG5cclxuY29uc3QgZWNzID0gbmV3IEVDUygpO1xyXG5cclxuY29uc3QgZ2V0UHJvcGVydGllcyA9IChwcm9wczogQ2xvdWRGb3JtYXRpb25DdXN0b21SZXNvdXJjZUV2ZW50WydSZXNvdXJjZVByb3BlcnRpZXMnXSk6IEJsdWVHcmVlblNlcnZpY2VQcm9wcyA9PiAoe1xyXG4gIGNsdXN0ZXI6IHByb3BzLkNsdXN0ZXIsXHJcbiAgc2VydmljZU5hbWU6IHByb3BzLlNlcnZpY2VOYW1lLFxyXG4gIGNvbnRhaW5lck5hbWU6IHByb3BzLkNvbnRhaW5lck5hbWUsXHJcbiAgdGFza0RlZmluaXRpb246IHByb3BzLlRhc2tEZWZpbml0aW9uLFxyXG4gIGxhdW5jaFR5cGU6IHByb3BzLkxhdW5jaFR5cGUsXHJcbiAgcGxhdGZvcm1WZXJzaW9uOiBwcm9wcy5QbGF0Zm9ybVZlcnNpb24sXHJcbiAgZGVzaXJlZENvdW50OiBwcm9wcy5EZXNpcmVkQ291bnQsXHJcbiAgc3VibmV0czogcHJvcHMuU3VibmV0cyxcclxuICBzZWN1cml0eUdyb3VwczogcHJvcHMuU2VjdXJpdHlHcm91cHMsXHJcbiAgdGFyZ2V0R3JvdXBBcm46IHByb3BzLlRhcmdldEdyb3VwQXJuLFxyXG4gIGNvbnRhaW5lclBvcnQ6IHByb3BzLkNvbnRhaW5lclBvcnQsXHJcbiAgc2NoZWR1bGluZ1N0cmF0ZWd5OiBwcm9wcy5TY2hlZHVsaW5nU3RyYXRlZ3ksXHJcbiAgaGVhbHRoQ2hlY2tHcmFjZVBlcmlvZFNlY29uZHM6IHByb3BzLkhlYWx0aENoZWNrR3JhY2VQZXJpb2QsXHJcbiAgZGVwbG95bWVudENvbmZpZ3VyYXRpb246IHByb3BzLkRlcGxveW1lbnRDb25maWd1cmF0aW9uLFxyXG59KTtcclxuXHJcbmNvbnN0IG9uQ3JlYXRlID0gYXN5bmMgKGV2ZW50OiBDbG91ZEZvcm1hdGlvbkN1c3RvbVJlc291cmNlQ3JlYXRlRXZlbnQpOiBQcm9taXNlPEhhbmRsZXJSZXR1cm4+ID0+IHtcclxuICBjb25zdCB7XHJcbiAgICBjbHVzdGVyLFxyXG4gICAgc2VydmljZU5hbWUsXHJcbiAgICBjb250YWluZXJOYW1lLFxyXG4gICAgdGFza0RlZmluaXRpb24sXHJcbiAgICBsYXVuY2hUeXBlLFxyXG4gICAgcGxhdGZvcm1WZXJzaW9uLFxyXG4gICAgZGVzaXJlZENvdW50LFxyXG4gICAgc3VibmV0cyxcclxuICAgIHNlY3VyaXR5R3JvdXBzLFxyXG4gICAgdGFyZ2V0R3JvdXBBcm4sXHJcbiAgICBjb250YWluZXJQb3J0LFxyXG4gICAgc2NoZWR1bGluZ1N0cmF0ZWd5LFxyXG4gICAgaGVhbHRoQ2hlY2tHcmFjZVBlcmlvZFNlY29uZHMsXHJcbiAgICBkZXBsb3ltZW50Q29uZmlndXJhdGlvbixcclxuICB9ID0gZ2V0UHJvcGVydGllcyhldmVudC5SZXNvdXJjZVByb3BlcnRpZXMpO1xyXG5cclxuICBjb25zdCB7IHNlcnZpY2UgfSA9IGF3YWl0IGVjc1xyXG4gICAgLmNyZWF0ZVNlcnZpY2Uoe1xyXG4gICAgICBjbHVzdGVyLFxyXG4gICAgICBzZXJ2aWNlTmFtZSxcclxuICAgICAgdGFza0RlZmluaXRpb24sXHJcbiAgICAgIGxhdW5jaFR5cGUsXHJcbiAgICAgIHBsYXRmb3JtVmVyc2lvbixcclxuICAgICAgZGVzaXJlZENvdW50LFxyXG4gICAgICBzY2hlZHVsaW5nU3RyYXRlZ3ksXHJcbiAgICAgIGRlcGxveW1lbnRDb250cm9sbGVyOiB7XHJcbiAgICAgICAgdHlwZTogJ0NPREVfREVQTE9ZJyxcclxuICAgICAgfSxcclxuICAgICAgbmV0d29ya0NvbmZpZ3VyYXRpb246IHtcclxuICAgICAgICBhd3N2cGNDb25maWd1cmF0aW9uOiB7XHJcbiAgICAgICAgICBzdWJuZXRzLFxyXG4gICAgICAgICAgc2VjdXJpdHlHcm91cHMsXHJcbiAgICAgICAgfSxcclxuICAgICAgfSxcclxuICAgICAgZGVwbG95bWVudENvbmZpZ3VyYXRpb24sXHJcbiAgICAgIGhlYWx0aENoZWNrR3JhY2VQZXJpb2RTZWNvbmRzLFxyXG4gICAgICBsb2FkQmFsYW5jZXJzOiBbXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgdGFyZ2V0R3JvdXBBcm46IHRhcmdldEdyb3VwQXJuLFxyXG4gICAgICAgICAgY29udGFpbmVyUG9ydCxcclxuICAgICAgICAgIGNvbnRhaW5lck5hbWUsXHJcbiAgICAgICAgfSxcclxuICAgICAgXSxcclxuICAgIH0pXHJcbiAgICAucHJvbWlzZSgpO1xyXG5cclxuICBpZiAoIXNlcnZpY2UpIHRocm93IEVycm9yKCdTZXJ2aWNlIGNvdWxkIG5vdCBiZSBjcmVhdGVkJyk7XHJcblxyXG4gIHJldHVybiB7XHJcbiAgICBQaHlzaWNhbFJlc291cmNlSWQ6IHNlcnZpY2Uuc2VydmljZUFybiBhcyBzdHJpbmcsXHJcbiAgICBEYXRhOiB7XHJcbiAgICAgIFNlcnZpY2VOYW1lOiBzZXJ2aWNlLnNlcnZpY2VOYW1lIGFzIHN0cmluZyxcclxuICAgIH0sXHJcbiAgfTtcclxufTtcclxuXHJcbi8qKlxyXG4gKiBGb3Igc2VydmljZXMgdXNpbmcgdGhlIGJsdWUvZ3JlZW4gKENPREVfREVQTE9ZKSBkZXBsb3ltZW50IGNvbnRyb2xsZXIsXHJcbiAqIG9ubHkgdGhlIGRlc2lyZWQgY291bnQsIGRlcGxveW1lbnQgY29uZmlndXJhdGlvbiwgdGFzayBwbGFjZW1lbnQgY29uc3RyYWludHNcclxuICogYW5kIHN0cmF0ZWdpZXMsIGFuZCBoZWFsdGggY2hlY2sgZ3JhY2UgcGVyaW9kIGNhbiBiZSB1cGRhdGVkIHVzaW5nIHRoaXMgQVBJLlxyXG4gKiBJZiB0aGUgbmV0d29yayBjb25maWd1cmF0aW9uLCBwbGF0Zm9ybSB2ZXJzaW9uLCBvciB0YXNrIGRlZmluaXRpb24gbmVlZCB0byBiZVxyXG4gKiB1cGRhdGVkLCBhIG5ldyBBV1MgQ29kZURlcGxveSBkZXBsb3ltZW50IHNob3VsZCBiZSBjcmVhdGVkLlxyXG4gKiBGb3IgbW9yZSBpbmZvcm1hdGlvbiwgc2VlIENyZWF0ZURlcGxveW1lbnQgaW4gdGhlIEFXUyBDb2RlRGVwbG95IEFQSSBSZWZlcmVuY2UuXHJcbiAqL1xyXG5jb25zdCBvblVwZGF0ZSA9IGFzeW5jIChldmVudDogQ2xvdWRGb3JtYXRpb25DdXN0b21SZXNvdXJjZVVwZGF0ZUV2ZW50KTogUHJvbWlzZTxIYW5kbGVyUmV0dXJuPiA9PiB7XHJcbiAgY29uc3QgeyBjbHVzdGVyLCBzZXJ2aWNlTmFtZSwgZGVzaXJlZENvdW50LCBkZXBsb3ltZW50Q29uZmlndXJhdGlvbiwgaGVhbHRoQ2hlY2tHcmFjZVBlcmlvZFNlY29uZHMgfSA9IGdldFByb3BlcnRpZXMoZXZlbnQuUmVzb3VyY2VQcm9wZXJ0aWVzKTtcclxuXHJcbiAgY29uc3QgeyBzZXJ2aWNlIH0gPSBhd2FpdCBlY3NcclxuICAgIC51cGRhdGVTZXJ2aWNlKHtcclxuICAgICAgc2VydmljZTogc2VydmljZU5hbWUsXHJcbiAgICAgIGNsdXN0ZXIsXHJcbiAgICAgIGRlc2lyZWRDb3VudCxcclxuICAgICAgZGVwbG95bWVudENvbmZpZ3VyYXRpb24sXHJcbiAgICAgIGhlYWx0aENoZWNrR3JhY2VQZXJpb2RTZWNvbmRzLFxyXG4gICAgfSlcclxuICAgIC5wcm9taXNlKCk7XHJcblxyXG4gIGlmICghc2VydmljZSkgdGhyb3cgRXJyb3IoJ1NlcnZpY2UgY291bGQgbm90IGJlIHVwZGF0ZWQnKTtcclxuXHJcbiAgcmV0dXJuIHtcclxuICAgIFBoeXNpY2FsUmVzb3VyY2VJZDogc2VydmljZS5zZXJ2aWNlQXJuIGFzIHN0cmluZyxcclxuICAgIERhdGE6IHtcclxuICAgICAgU2VydmljZU5hbWU6IHNlcnZpY2Uuc2VydmljZU5hbWUgYXMgc3RyaW5nLFxyXG4gICAgfSxcclxuICB9O1xyXG59O1xyXG5cclxuY29uc3Qgb25EZWxldGUgPSBhc3luYyAoZXZlbnQ6IENsb3VkRm9ybWF0aW9uQ3VzdG9tUmVzb3VyY2VEZWxldGVFdmVudCk6IFByb21pc2U8dm9pZD4gPT4ge1xyXG4gIGNvbnN0IHsgY2x1c3Rlciwgc2VydmljZU5hbWUgfSA9IGdldFByb3BlcnRpZXMoZXZlbnQuUmVzb3VyY2VQcm9wZXJ0aWVzKTtcclxuXHJcbiAgYXdhaXQgZWNzXHJcbiAgICAuZGVsZXRlU2VydmljZSh7XHJcbiAgICAgIHNlcnZpY2U6IHNlcnZpY2VOYW1lLFxyXG4gICAgICBjbHVzdGVyLFxyXG4gICAgICBmb3JjZTogdHJ1ZSxcclxuICAgIH0pXHJcbiAgICAucHJvbWlzZSgpO1xyXG5cclxuICBhd2FpdCBlY3NcclxuICAgIC53YWl0Rm9yKCdzZXJ2aWNlc0luYWN0aXZlJywge1xyXG4gICAgICBjbHVzdGVyLFxyXG4gICAgICBzZXJ2aWNlczogW3NlcnZpY2VOYW1lXSxcclxuICAgIH0pXHJcbiAgICAucHJvbWlzZSgpO1xyXG59O1xyXG5cclxuZXhwb3J0IGNvbnN0IGhhbmRsZXIgPSBhc3luYyAoZXZlbnQ6IENsb3VkRm9ybWF0aW9uQ3VzdG9tUmVzb3VyY2VFdmVudCk6IFByb21pc2U8SGFuZGxlclJldHVybiB8IHZvaWQ+ID0+IHtcclxuICBjb25zdCByZXF1ZXN0VHlwZSA9IGV2ZW50LlJlcXVlc3RUeXBlO1xyXG5cclxuICBzd2l0Y2ggKHJlcXVlc3RUeXBlKSB7XHJcbiAgICBjYXNlICdDcmVhdGUnOlxyXG4gICAgICByZXR1cm4gb25DcmVhdGUoZXZlbnQgYXMgQ2xvdWRGb3JtYXRpb25DdXN0b21SZXNvdXJjZUNyZWF0ZUV2ZW50KTtcclxuICAgIGNhc2UgJ1VwZGF0ZSc6XHJcbiAgICAgIHJldHVybiBvblVwZGF0ZShldmVudCBhcyBDbG91ZEZvcm1hdGlvbkN1c3RvbVJlc291cmNlVXBkYXRlRXZlbnQpO1xyXG4gICAgY2FzZSAnRGVsZXRlJzpcclxuICAgICAgcmV0dXJuIG9uRGVsZXRlKGV2ZW50IGFzIENsb3VkRm9ybWF0aW9uQ3VzdG9tUmVzb3VyY2VEZWxldGVFdmVudCk7XHJcbiAgICBkZWZhdWx0OlxyXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYEludmFsaWQgcmVxdWVzdCB0eXBlOiAke3JlcXVlc3RUeXBlfWApO1xyXG4gIH1cclxufTtcclxuIl19